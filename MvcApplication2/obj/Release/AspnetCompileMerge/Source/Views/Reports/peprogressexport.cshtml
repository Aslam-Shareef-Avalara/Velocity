@using PagedList.Mvc;
@model MvcApplication2.ViewModel.PeProgressViewModel

@{

    ViewBag.Title = "PE Progress";

    if (Model.peprogressList.Count() > 0)
    {
        ViewBag.Title = Model.peprogressList[0].Evalcycle.Title;
    }
    else
    {
        List<DataService.EvaluationCycle> evs = ViewBag.EvalCycles;
        if (evs != null && evs.Any(x => x.Id == ViewBag.EvalCycleId))
        {
            ViewBag.Title = evs.FirstOrDefault(x => x.Id == ViewBag.EvalCycleId).Title;
        }

    }
}
@functions{
    public string translateStatus(int? statusCode)
    {
        return DataService.GoalStatus.Translate(statusCode);
    }
    public string translateBoolean(bool val)
    {
        return val ? "Yes" : "No";
    }
    public string RestructureFeedback(List<DataService.FeedbackAnswer> feedback)
    {
        string answers = "";
        foreach (DataService.FeedbackAnswer ans in feedback)
        {
            answers += ans.Answer + "<br>";
        }
        return answers;
    }
    public string RestructureTraining(string training)
    {
        string trainingNeeds = "";
        string[] s = training.Split(new string[] { "$$$" }, StringSplitOptions.RemoveEmptyEntries);
        int counter = 1;
        foreach (string t in s)
        {
            trainingNeeds += counter +") "+t + "<br>";
            counter++;
        }
        return trainingNeeds;
    }
}

<table class="" style="border:thin solid gray; letter-spacing:1px;" id="employeelist">
    <tr class="header" style="background-color: rgb(55, 70, 89);color:white;">
        <th class="controls-head">Employee Id</th>
        <th class="controls-head">Employee Name</th>
        <th class="controls-head">Status</th>
        <th class="controls-head">Pending Action</th>
        <th class="controls-head">Chat</th>
        <th class="controls-head">Manager</th>
        <th class="controls-head">Manager Rating</th>
        <th class="controls-head">Employee Rating</th>
        <th class="controls-head">Published Rating</th>
        <th class="controls-head">Summary</th>
        <th class="controls-head">Training</th>
        <th class="controls-head">Feedback</th>
    </tr>
    @{
        int counter = 1;
    }
    @foreach (var item in Model.peprogressList)
    {
        string nextStage = DataService.GoalStatus.NextStage(item.goal.Status);
        <tr style="background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">
            <td style="border:thin solid gray;background-color:@(counter%2==0?"#dddddd":"white") ;">@item.Employee.OrgEmpId</td>
            <td style="border:thin solid gray;background-color:@(counter%2==0?"#dddddd":"white") ;">@item.Employee.FirstName @item.Employee.LastName</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@translateStatus(item.goal.Status)</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@nextStage</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;"><a href="sip:@(nextStage.Contains("Employee")?item.Employee.Email:(nextStage.Contains("Manager")?item.Manager.Email:""))">Click to chat</a></td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@item.Manager.FirstName &nbsp; @item.Manager.LastName </td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@item.EvalRating.ManagerOverllRating</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@item.EvalRating.SelfOverallRating</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@(item.MeetingSummarySubmitted ? item.EvalRating.ManagerOverllRating : 0M)</td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@(item.Conclusion != null ? item.Conclusion.meetingsummary : "") </td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@Html.Raw(item.Conclusion != null ? RestructureTraining(item.Conclusion.training) : "")  </td>
            <td style="border:thin solid gray;background-color:@(counter % 2 == 0 ? "#dddddd" : "white") ;">@Html.Raw(item.Feedback != null && item.Feedback.Count > 0 ? RestructureFeedback(item.Feedback) : "")       </td>
        </tr>
        counter++;
    }

</table>